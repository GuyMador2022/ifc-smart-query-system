# 📊 מערכת לוגים מתקדמת לשאלות משתמשים

## 🎯 מה זה?

מערכת מתקדמת לתיעוד וניתוח כל השאלות שמשתמשים שואלים במערכת ה-IFC. המערכת תעזור לכם להבין:

- **מה משתמשים שואלים** בפועל
- **איזה מקצועות הכי פעילים** (אדריכלים/מהנדסים/בעלי פרויקטים)
- **אילו שאלות הכי פופולריות**
- **אחוזי הצלחה** של השאילתות
- **ביצועי המערכת** (זמני תגובה)
- **שימוש ב-AI** לעומת שאילתות ידניות

## 🚀 איך להתחיל?

### 1. הפעלה מהירה
```bash
cd "c:\Users\PC\Desktop\אפליקציות בפיתוח\ifc-2-duckdb-master - GUI\ifc-2-duckdb-master"
python launcher.py
```

### 2. הפעלה ישירה של האפליקציה
```bash
streamlit run app.py --server.port 8502
```

### 3. דשבורד Analytics נפרד
```bash
streamlit run analytics_dashboard.py --server.port 8503
```

## 📊 מה נרשם בלוגים?

כל שאלה שמשתמש שואל נרשמת עם הפרטים הבאים:

### מידע בסיסי
- ⏰ **זמן מדויק** של השאלה
- 👤 **Session ID** (מזהה יחודי לכל משתמש)
- 🗣️ **השאלה המלאה** שנשאלה
- 👷 **מקצוע** (אדריכל/מהנדס/בעל פרויקט)
- 📂 **קטגוריה** (אלמנטי בנייה/מבנה/עלויות וכו')

### מידע טכני
- 🔧 **סוג השאלה** (שאלה מוכנה/תרגום AI/SQL ידני/צ'אט חופשי)
- 🤖 **האם השתמש ב-AI** לתרגום השאלה
- 💾 **השאילתת SQL** שהורצה
- ✅ **האם הצליחה** השאילתה
- ⏱️ **זמן ביצוע** במילישניות
- 📈 **מספר תוצאות** שהתקבלו
- ❌ **הודעת שגיאה** במקרה של כשל

## 📁 איפה נשמרים הלוגים?

המערכת יוצרת תיקייה `logs/` עם הקבצים הבאים:

### 1. `user_queries.jsonl`
```json
{"timestamp": "2025-09-19T18:38:48", "user_question": "כמה קירות יש?", "profession": "אדריכל", "success": true, ...}
{"timestamp": "2025-09-19T18:39:15", "user_question": "מה מידות הקורות?", "profession": "מהנדס", "success": true, ...}
```
- פורמט JSON Lines (קל לעיבוד אוטומטי)
- כל שורה = שאלה אחת
- מושלם לניתוח נתונים

### 2. `user_queries.csv`
| timestamp | user_question | profession | success | execution_time_ms |
|-----------|---------------|------------|---------|-------------------|
| 2025-09-19T18:38:48 | כמה קירות יש? | אדריכל | true | 45.2 |
| 2025-09-19T18:39:15 | מה מידות הקורות? | מהנדס | true | 78.5 |

- פורמט CSV (נוח ל-Excel)
- ניתן לפתוח ב-Excel/Google Sheets
- מושלם לחישובי סטטיסטיקות

### 3. `queries_YYYYMMDD.log`
```
2025-09-19 18:38:48 - INFO - ✅ שאלה [אדריכל]: 'כמה קירות יש?' | סוג: predefined | AI: לא | תוצאות: 12
2025-09-19 18:39:15 - INFO - ✅ שאלה [מהנדס]: 'מה מידות הקורות?' | סוג: ai_translation | AI: כן | תוצאות: 5
```
- לוג יומי קריא לבני אדם
- נוח למעקב בזמן אמת
- כולל אמוג'י לזיהוי מהיר

## 📊 איך לראות Analytics?

### דרך הממשק הראשי (מומלץ)
1. פתח את האפליקציה: http://localhost:8502
2. לחץ על טאב **"📊 Analytics"**
3. צפה בסטטיסטיקות בזמן אמת:
   - 🎯 שאלות היום
   - ✅ אחוז הצלחה
   - 🤖 שימוש ב-AI
   - ⏱️ זמן ממוצע

### דשבורד Analytics מפורט
1. הפעל: `streamlit run analytics_dashboard.py --server.port 8503`
2. פתח: http://localhost:8503
3. קבל גרפים מתקדמים:
   - 📈 מגמות לאורך זמן
   - 👥 פילוח לפי מקצועות
   - 📊 סוגי שאלות
   - 🔍 שאלות פופולריות
   - 💾 ייצוא נתונים

### דוח מהיר בטרמינל
```bash
python -c "from query_logger import query_logger; print(query_logger.generate_analytics_report(7))"
```

## 🔧 דוגמאות שימוש

### הרצת דמו
```bash
python test_logger.py
```
יוצר 5 שאלות דמו ומציג analytics

### קבלת סטטיסטיקות יומיות
```python
from query_logger import query_logger

# סטטיסטיקות של היום
stats = query_logger.get_daily_stats()
print(f"שאלות היום: {stats['total_queries']}")
print(f"אחוז הצלחה: {stats['successful_queries'] / stats['total_queries'] * 100:.1f}%")
```

### ייצוא נתונים
```python
from query_logger import query_logger

# ייצוא 30 ימים אחרונים לאקסל
result = query_logger.export_data("excel", 30)
print(result)  # ✅ ייצוא ל-Excel: logs/query_analytics_20250919_183045.xlsx
```

### רישום שאלה ידני
```python
from query_logger import log_user_question

log_user_question(
    user_question="כמה קירות יש בבניין?",
    profession="אדריכל",
    category="אלמנטי בנייה",
    query_type="ai_translation",
    sql_query="SELECT COUNT(*) FROM walls",
    success=True,
    execution_time_ms=45.2,
    result_rows=1,
    ai_translation_used=True
)
```

## 🎯 תוצאות מעשיות

### מה תגלו על המשתמשים שלכם:

1. **השאלות הכי פופולריות**
   - "כמה קירות יש?" - 25 פעמים
   - "מה המחיר הכולל?" - 18 פעמים
   - "איפה החלונות?" - 12 פעמים

2. **מקצועות הכי פעילים**
   - אדריכלים: 45% מהשאלות
   - מהנדסים: 35% מהשאלות  
   - בעלי פרויקטים: 20% מהשאלות

3. **ביצועי המערכת**
   - זמן ממוצע: 67ms
   - אחוז הצלחה: 89%
   - שימוש ב-AI: 78%

4. **שעות פעילות**
   - פיק: 10:00-12:00, 14:00-16:00
   - פחות פעילות: 12:00-14:00 (הפסקת צהריים)

### איך להשתמש בנתונים:

1. **שיפור המערכת**
   - הוסף שאלות מוכנות לנושאים פופולריים
   - שפר ביצועים בשאילתות איטיות
   - תקן שגיאות נפוצות

2. **הבנת משתמשים**
   - מתמחה בשאלות של מקצוע מסוים?
   - צור תוכן ממוקד
   - התאם את הממשק לצרכים

3. **תכנון פיתוח**
   - איפה להשקיע משאבי פיתוח?
   - אילו features הכי חשובים?
   - איך לשפר את חוויית המשתמש?

## 🔒 פרטיות ואבטחה

- **אין שמירת מידע אישי** - רק session ID אנונימי
- **לא נשמר IP** או פרטים מזהים
- **רק שאלות ותוצאות** טכניות
- **לוגים מקומיים** - לא נשלחים לשרתים חיצוניים

## 🆘 פתרון בעיות

### המערכת לא יוצרת לוגים?
```bash
# בדוק אם התיקייה קיימת
ls logs/

# אם לא, צור אותה
mkdir logs

# הרץ דמו לבדיקה
python test_logger.py
```

### Analytics לא מציג נתונים?
- ודא שיש לוגים בתיקייה `logs/`
- בדוק שהתאריכים נכונים
- הרץ דמו ליצירת נתונים דמה

### שגיאות ב-imports?
```bash
pip install streamlit pandas plotly
```

## 🚀 העתיד

### תכונות מתוכננות:
- 📧 התראות אוטומטיות על מגמות חשובות
- 🔄 סנכרון עם מסדי נתונים חיצוניים  
- 🤖 המלצות אוטומטיות לשיפור המערכת
- 📱 ממשק נייד לניתוח נתונים
- 🎯 A/B testing למאפיינים חדשים

### השתתפות בפיתוח:
- דווח על bugs בלוגים
- הצע תכונות חדשות לניתוח
- שתף דוגמאות שימוש מעניינות

---

**🎉 מערכת הלוגים מוכנה לשימוש!**

התחל לאסוף נתונים על המשתמשים שלך ולהבין איך הם באמת משתמשים במערכת ה-IFC שלך. כל שאלה = הזדמנות ללמוד ולשפר! 🚀